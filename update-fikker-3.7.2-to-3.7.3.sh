FikkerUpdateDir="/root" # 新版本默认安装目录
FikkerNewVersion="fikkerd-3.7.3-linux-x86-64" # 最新版本安装包名称
FikkerOldVersion=`awk -F '/' '{print $(NF-1)}' /etc/fikkerd/fikkerd.pwd`
FikkerOldVersionDir=`awk -F ''$FikkerOldVersion'' '{print $1}' /etc/fikkerd/fikkerd.pwd`
echo 'step 1 ...' && cd /tmp && wget -c http://www.fikker.com/dl/$FikkerNewVersion.tar.gz && tar zxf $FikkerNewVersion.tar.gz && rm -rf $FikkerNewVersion.tar.gz && rm -rf ${FikkerNewVersion}/config ${FikkerNewVersion}/binding ${FikkerNewVersion}/plugins/*.ini && echo 'step 2 ...' && cd $FikkerOldVersionDir/$FikkerOldVersion && (./fikkerd.sh stop 2> /dev/null ; true) && echo 'step 3 ...' && cp -af config /tmp/$FikkerNewVersion/ && cp -af binding /tmp/$FikkerNewVersion/ && cp -af plugins/*.ini /tmp/$FikkerNewVersion/plugins/ && echo 'step 4 ...' && cd $FikkerUpdateDir && if [ ! -d "old-fik" ]; then mkdir old-fik; fi && mv $FikkerOldVersionDir/$FikkerOldVersion old-fik/ && cd $FikkerUpdateDir/old-fik && tar zcf $FikkerOldVersion-old.tar.gz $FikkerOldVersion && rm -rf $FikkerOldVersion && echo 'step 5 ...' && rm -rf $FikkerUpdateDir/$FikkerNewVersion && mv /tmp/$FikkerNewVersion $FikkerUpdateDir/ && cd $FikkerUpdateDir/$FikkerNewVersion && ./fikkerd.sh install && ./fikkerd.sh start && cd $FikkerUpdateDir && echo 'finished!'
